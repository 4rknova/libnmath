# paths
# - target
spath = src
opath = $(bpath)/obj
# - source
ccsrc = $(wildcard $(spath)/*.cc)

# binaries
obj = $(ccsrc:.cc=.o) 
bin = $(bpath)/$(pkgname)

lib_a = $(bin).a
lib_so = $(bin).$(so)

CC = gcc
CXX = g++
CCFLAGS = -std=c89 -Wall -Wno-strict-aliasing $(opt) $(dbg) -fPIC -Isrc
CXXFLAGS = -ansi -pedantic -Wall -Wno-strict-aliasing $(opt) $(dbg) -fPIC -Isrc
LDFLAGS =

.PHONY: install
install: $(lib_a) $(lib_so)
	$(INSTALL) -d $(PREFIX)/lib
	$(INSTALL) -m 644 $(lib_a) $(lib_so) $(PREFIX)/lib
	$(INSTALL) -d $(PREFIX)/include/nmath
	cd src; $(INSTALL) -m 644 *.h *.inl $(PREFIX)/include/nmath
	$(INSTALL) -d $(PREFIX)/lib/pkgconfig
	$(INSTALL) -m 644 nmath.pc $(PREFIX)/lib/pkgconfig

.PHONY: uninstall
uninstall:
	rm -f $(PREFIX)/lib/$(lib_a)
	rm -f $(PREFIX)/lib/$(lib_so)
	rm -f $(PREFIX)/include/nmath/*
	rmdir $(PREFIX)/include/nmath
	rm -f $(PREFIX)/lib/pkgconfig/nmath.pc

.PHONY: all
all: $(lib_a) $(lib_so)

$(lib_a): $(obj)
	$(AR) rcs $@ $^

$(lib_so): $(obj)
	$(CC) $(CFLAGS) $(shared) -o $@ $(obj) $(LDFLAGS)

%.o: %.cc
	$(CXX) -c $(CXXFLAGS) -o $@  $<

.PHONY: clean
clean:
	rm -rf $(obj)

.PHONY: clean-all
clean-all: clean
	rm -f Makefile nmath.pc $(dep) $(lib_so) $(lib_a)

